<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Draw a function • flow</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Draw a function">
<meta property="og:description" content="flow">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flow</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Draw-a-function.html">Draw a function</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../diagrams.html">Diagrams</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Draw-a-function_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="Draw-a-function_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><script src="Draw-a-function_files/dagre-0.8.4/dagre.min.js"></script><script src="Draw-a-function_files/lodash-4.17.15/lodash.js"></script><script src="Draw-a-function_files/nomnoml-0.7.2/nomnoml.js"></script><script src="Draw-a-function_files/nomnoml-binding-0.2.0/nomnoml.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Draw a function</h1>
            
      
      
      <div class="hidden name"><code>Draw-a-function.Rmd</code></div>

    </div>

    
    
<div id="your-first-diagram" class="section level2">
<h2 class="hasAnchor">
<a href="#your-first-diagram" class="anchor"></a>Your first diagram</h2>
<p>We use the function <code><a href="../reference/flow_view.html">flow_view()</a></code> to draw a function as a diagram. It can be any function, packaged or user made, as long as it has a body.</p>
<p>Take the <code>rle</code> function from base R, its role is to (citing <code><a href="https://rdrr.io/r/base/rle.html">?rle</a></code>):</p>
<blockquote>
<p>Compute the lengths and values of runs of equal values in a vector</p>
</blockquote>
<p>For instance:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/rle.html">rle</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">6</span> , <span class="fl">6</span>))
<span class="co">#&gt; Run Length Encoding</span>
<span class="co">#&gt;   lengths: int [1:3] 3 1 2</span>
<span class="co">#&gt;   values : num [1:3] 3 1 6</span></pre></body></html></div>
<p>And its code is :</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">rle</span>
<span class="co">#&gt; function (x) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (!is.vector(x) &amp;&amp; !is.list(x)) </span>
<span class="co">#&gt;         stop("'x' must be a vector of an atomic type")</span>
<span class="co">#&gt;     n &lt;- length(x)</span>
<span class="co">#&gt;     if (n == 0L) </span>
<span class="co">#&gt;         return(structure(list(lengths = integer(), values = x), </span>
<span class="co">#&gt;             class = "rle"))</span>
<span class="co">#&gt;     y &lt;- x[-1L] != x[-n]</span>
<span class="co">#&gt;     i &lt;- c(which(y | is.na(y)), n)</span>
<span class="co">#&gt;     structure(list(lengths = diff(c(0L, i)), values = x[i]), </span>
<span class="co">#&gt;         class = "rle")</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x00000000120158b0&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:base&gt;</span></pre></body></html></div>
<p>The function is not overly complex but its logic is not obvious at first glance. <code><a href="../reference/flow_view.html">flow_view()</a></code> helps us sort it out.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">flow</span>)
<span class="fu"><a href="../reference/flow_view.html">flow_view</a></span>(<span class="no">rle</span>)</pre></body></html></div>
<div id="htmlwidget-ab5635a64253a86c68c3" style="width:768px;height:768px;" class="nomnoml html-widget"></div>
<script type="application/json" data-for="htmlwidget-ab5635a64253a86c68c3">{"x":{"code":"#.if: visual=rhomb fill=#e2efda align=center\n#.for: visual=rhomb fill=#ddebf7 align=center\n#.repeat: visual=rhomb fill=#fce4d6 align=center\n#.while: visual=rhomb fill=#fff2cc align=center\n#.standard: visual=class fill=#ededed align=left\n#.commented: visual=class fill=#ededed\n#.header: visual=roundrect fill=#d9e1f2 align=left\n#.return: visual=end fill=#70ad47  empty\n#.stop: visual=end fill=#ed7d31  empty\n#.break: visual=receiver fill=#ffc000 empty\n#.next: visual=transceiver fill=#5b9bd5  empty\n#arrowSize: 1\n#bendSize: 0.3\n#direction: down\n#gutter: 5\n#edgeMargin: 0\n#edges: hard\n#fill: #eee8d5\n#fillArrows: false\n#font: Courier\n#fontSize: 12\n#leading: 1.25\n#lineWidth: 3\n#padding: 16\n#spacing: 40\n#stroke: #33322E\n#title: filename\n#zoom: 1\n#acyclicer: greedy\n#ranker: network-simplex\n\n[<header>rle(x)]  -> [<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 2: ;stop(\"'x'⠀must⠀be⠀a⠀vector⠀of⠀an⠀atomic⠀type\")]\n[<standard> 2: ;stop(\"'x'⠀must⠀be⠀a⠀vector⠀of⠀an⠀atomic⠀type\")]  -> [<stop> -2:]\n[<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -1:]\n[<end> -1:]  -> [<standard> 3: ;n⠀<-⠀length(x)]\n[<standard> 3: ;n⠀<-⠀length(x)]  -> [<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 5: ;return(structure(list(\n⠀⠀lengths⠀=⠀integer(),\n⠀⠀values⠀=⠀x\n),⠀class⠀=⠀\"rle\"))]\n[<standard> 5: ;return(structure(list(\n⠀⠀lengths⠀=⠀integer(),\n⠀⠀values⠀=⠀x\n),⠀class⠀=⠀\"rle\"))]  -> [<return> -5:]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -4:]\n[<end> -4:]  -> [<standard> 6: ;y⠀<-⠀x\\[-1L\\]⠀!=⠀x\\[-n\\]\ni⠀<-⠀c(which(y⠀\\|⠀is.na(y)),⠀n)\nstructure(list(\n⠀⠀lengths⠀=⠀diff(c(0L,⠀i)),\n⠀⠀values⠀=⠀x\\[i\\]\n),⠀class⠀=⠀\"rle\")]\n[<standard> 6: ;y⠀<-⠀x\\[-1L\\]⠀!=⠀x\\[-n\\]\ni⠀<-⠀c(which(y⠀\\|⠀is.na(y)),⠀n)\nstructure(list(\n⠀⠀lengths⠀=⠀diff(c(0L,⠀i)),\n⠀⠀values⠀=⠀x\\[i\\]\n),⠀class⠀=⠀\"rle\")]  -> [<return> 7:]","svg":false},"evals":[],"jsHooks":[]}</script><p><code>if</code> statements always branch into two paths, whether an <code>else</code> clause is present or not. <code>for</code>, <code>while</code>, and <code>repeat</code> loops are also supported.</p>
<p>The colored circles are exit points, orange for errors (using <code><a href="https://rdrr.io/r/base/stop.html">stop()</a></code>), green for returned values (using <code><a href="https://rdrr.io/r/base/function.html">return()</a></code>) or just reaching the end of the function.</p>
<p>There you go, you know all you need to get started! And for this example and many this will be pretty much all you need.</p>
<p>For other cases we propose the following features.</p>
</div>
<div id="export-to-pdf-png-jpg-or-html" class="section level2">
<h2 class="hasAnchor">
<a href="#export-to-pdf-png-jpg-or-html" class="anchor"></a>Export to pdf, png, jpg, or html</h2>
<p><em>{flow}</em> supports saving your diagrams to various formats by using the argument <code>out</code>.</p>
<p>If <code>out</code> is a path, the diagram will be saved there, using the file extension to determine the format. For instance:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/flow_view.html">flow_view</a></span>(<span class="no">rle</span>, <span class="kw">out</span> <span class="kw">=</span> <span class="st">"diagrams/rle.png"</span>)</pre></body></html></div>
<p>If you don’t want to save at a specific location but just want to open your diagram in a different format, use the shorthands <code>"pdf"</code>, <code>"png"</code>, <code>"jpg"</code>, <code>"jpeg"</code>, <code>"htm"</code> , <code>"html"</code> and <code><a href="../reference/flow_view.html">flow_view()</a></code> will save it to a temporary location, print and return its url, and open this location using <code>browseURL</code> (which opens your files with your relevant default viewer). For instance:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/flow_view.html">flow_view</a></span>(<span class="no">rle</span>, <span class="kw">out</span> <span class="kw">=</span> <span class="st">"html"</span>)
<span class="co">#&gt; The diagram was saved to '*******.html'</span>
<span class="co">#&gt; [1] "*******.html"</span></pre></body></html></div>
<p>When exporting to <em>html</em>, you might sometimes want to use SVG rendering by using the argument <code>svg = TRUE</code>. A difference is that it makes text selectable.</p>
</div>
<div id="display-comments-as-code-block-headers" class="section level2">
<h2 class="hasAnchor">
<a href="#display-comments-as-code-block-headers" class="anchor"></a>Display comments as code block headers</h2>
<p>Comments and diagrams are two nice ways of understanding code, so why not use them together? This is done by using the <code>prefix</code> argument. Comments in your call will be treated as block headers if they start with the given prefix.</p>
<p>Let’s rework our <code>rle</code> function by adding helpful comments, prefixed by <code>"##"</code> :</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">rle</span> <span class="kw">&lt;-</span> <span class="kw">function</span> (<span class="no">x</span>)
{
  <span class="co"># A rle object is a list containing elements length and value. It is</span>
  <span class="co"># assigned a class "rle"</span>

    <span class="co">## is argument of wrong type ?</span>
    <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/vector.html">is.vector</a></span>(<span class="no">x</span>) <span class="kw">&amp;&amp;</span> !<span class="fu"><a href="https://rdrr.io/r/base/list.html">is.list</a></span>(<span class="no">x</span>))
        <span class="fu"><a href="https://rdrr.io/r/base/stop.html">stop</a></span>(<span class="st">"'x' must be a vector of an atomic type"</span>)
    <span class="no">n</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>)
    <span class="kw">if</span> (<span class="no">n</span> <span class="kw">==</span> <span class="fl">0L</span>) {
        <span class="co">## return a rle object with zero length elements</span>
        <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">lengths</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">integer</a></span>(), <span class="kw">values</span> <span class="kw">=</span> <span class="no">x</span>),
            <span class="kw">class</span> <span class="kw">=</span> <span class="st">"rle"</span>))
    }
    <span class="co">## compute index of elements that are distinct from the next</span>
    <span class="no">y</span> <span class="kw">&lt;-</span> <span class="no">x</span>[-<span class="fl">1L</span>] <span class="kw">!=</span> <span class="no">x</span>[-<span class="no">n</span>]
    <span class="no">i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">y</span> <span class="kw">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">y</span>)), <span class="no">n</span>)
    <span class="co">## compute the final object</span>
    <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">lengths</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0L</span>, <span class="no">i</span>)), <span class="kw">values</span> <span class="kw">=</span> <span class="no">x</span>[<span class="no">i</span>]),
        <span class="kw">class</span> <span class="kw">=</span> <span class="st">"rle"</span>)
}

<span class="fu"><a href="../reference/flow_view.html">flow_view</a></span>(<span class="no">rle</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"##"</span>)</pre></body></html></div>
<div id="htmlwidget-6ba779adad406f1f2fef" style="width:768px;height:768px;" class="nomnoml html-widget"></div>
<script type="application/json" data-for="htmlwidget-6ba779adad406f1f2fef">{"x":{"code":"#.if: visual=rhomb fill=#e2efda align=center\n#.for: visual=rhomb fill=#ddebf7 align=center\n#.repeat: visual=rhomb fill=#fce4d6 align=center\n#.while: visual=rhomb fill=#fff2cc align=center\n#.standard: visual=class fill=#ededed align=left\n#.commented: visual=class fill=#ededed\n#.header: visual=roundrect fill=#d9e1f2 align=left\n#.return: visual=end fill=#70ad47  empty\n#.stop: visual=end fill=#ed7d31  empty\n#.break: visual=receiver fill=#ffc000 empty\n#.next: visual=transceiver fill=#5b9bd5  empty\n#arrowSize: 1\n#bendSize: 0.3\n#direction: down\n#gutter: 5\n#edgeMargin: 0\n#edges: hard\n#fill: #eee8d5\n#fillArrows: false\n#font: Courier\n#fontSize: 12\n#leading: 1.25\n#lineWidth: 3\n#padding: 16\n#spacing: 40\n#stroke: #33322E\n#title: filename\n#zoom: 1\n#acyclicer: greedy\n#ranker: network-simplex\n\n[<header>rle(x)]  -> [<if> 1: is argument of wrong type ?;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 1: is argument of wrong type ?;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 2: ;stop(\"'x'⠀must⠀be⠀a⠀vector⠀of⠀an⠀atomic⠀type\")]\n[<standard> 2: ;stop(\"'x'⠀must⠀be⠀a⠀vector⠀of⠀an⠀atomic⠀type\")]  -> [<stop> -2:]\n[<if> 1: is argument of wrong type ?;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -1:]\n[<end> -1:]  -> [<standard> 3: ;n⠀<-⠀length(x)]\n[<standard> 3: ;n⠀<-⠀length(x)]  -> [<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 5: return a rle object with zero length elements;return(structure(list(\n⠀⠀lengths⠀=⠀integer(),\n⠀⠀values⠀=⠀x\n),⠀class⠀=⠀\"rle\"))]\n[<standard> 5: return a rle object with zero length elements;return(structure(list(\n⠀⠀lengths⠀=⠀integer(),\n⠀⠀values⠀=⠀x\n),⠀class⠀=⠀\"rle\"))]  -> [<return> -5:]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -4:]\n[<end> -4:]  -> [<standard> 6: compute index of elements that are distinct from the next;y⠀<-⠀x\\[-1L\\]⠀!=⠀x\\[-n\\]\ni⠀<-⠀c(which(y⠀\\|⠀is.na(y)),⠀n)]\n[<standard> 6: compute index of elements that are distinct from the next;y⠀<-⠀x\\[-1L\\]⠀!=⠀x\\[-n\\]\ni⠀<-⠀c(which(y⠀\\|⠀is.na(y)),⠀n)]  -> [<standard> 7: compute the final object;structure(list(\n⠀⠀lengths⠀=⠀diff(c(0L,⠀i)),\n⠀⠀values⠀=⠀x\\[i\\]\n),⠀class⠀=⠀\"rle\")]\n[<standard> 7: compute the final object;structure(list(\n⠀⠀lengths⠀=⠀diff(c(0L,⠀i)),\n⠀⠀values⠀=⠀x\\[i\\]\n),⠀class⠀=⠀\"rle\")]  -> [<return> 8:]","svg":false},"evals":[],"jsHooks":[]}</script><p>We see that :</p>
<ul>
<li>The unprefixed comments are ignored.</li>
<li>Prefixed comments right before control flow calls (here <code>if</code>) will serve as headers for control flow header blocks.</li>
<li>Prefixed comments before other code will serve as headers for the subsequent code chunks.</li>
<li>Adding special comments in the middle of standard code,as we did in the last block, will split the block and use the comment as the header of the new block.</li>
</ul>
<p>Note the we used <code>{}</code> after <code>if (n == 0L)</code> compared to the original code. This is a current limitation, special comments are viewed as code we need the <code>{}</code> to keep both following lines in the <code>if</code> condition.</p>
<p>Misplaced comments, which cannot be used as headers, will be ignored, such as in :</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
  <span class="co">## comment</span>
  <span class="fl">1</span>)</pre></body></html></div>
<p>Nothing prevents you from choosing <code>prefix = "#"</code>, in that case all comments will be considered as headers.</p>
</div>
<div id="display-or-hide-the-code" class="section level2">
<h2 class="hasAnchor">
<a href="#display-or-hide-the-code" class="anchor"></a>Display or hide the code</h2>
<p>If you’re mainly interested in the logical structure of your code you can choose to remove the code from standard blocks, and have a lighter output :</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="../reference/flow_view.html">flow_view</a></span>(<span class="no">rle</span>, <span class="kw">code</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p></p>
<div id="htmlwidget-0fd0e059bd4b2d88cffd" style="width:768px;height:768px;" class="nomnoml html-widget"></div>
<script type="application/json" data-for="htmlwidget-0fd0e059bd4b2d88cffd">{"x":{"code":"#.if: visual=rhomb fill=#e2efda align=center\n#.for: visual=rhomb fill=#ddebf7 align=center\n#.repeat: visual=rhomb fill=#fce4d6 align=center\n#.while: visual=rhomb fill=#fff2cc align=center\n#.standard: visual=class fill=#ededed align=left\n#.commented: visual=class fill=#ededed\n#.header: visual=roundrect fill=#d9e1f2 align=left\n#.return: visual=end fill=#70ad47  empty\n#.stop: visual=end fill=#ed7d31  empty\n#.break: visual=receiver fill=#ffc000 empty\n#.next: visual=transceiver fill=#5b9bd5  empty\n#arrowSize: 1\n#bendSize: 0.3\n#direction: down\n#gutter: 5\n#edgeMargin: 0\n#edges: hard\n#fill: #eee8d5\n#fillArrows: false\n#font: Courier\n#fontSize: 12\n#leading: 1.25\n#lineWidth: 3\n#padding: 16\n#spacing: 40\n#stroke: #33322E\n#title: filename\n#zoom: 1\n#acyclicer: greedy\n#ranker: network-simplex\n\n[<header>rle(x)]  -> [<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 2:]\n[<standard> 2:]  -> [<stop> -2:]\n[<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -1:]\n[<end> -1:]  -> [<standard> 3:]\n[<standard> 3:]  -> [<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 5:]\n[<standard> 5:]  -> [<return> -5:]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -4:]\n[<end> -4:]  -> [<standard> 6:]\n[<standard> 6:]  -> [<return> 7:]","svg":false},"evals":[],"jsHooks":[]}</script> If you defined headers as we did in the previous section you can see the logic almost as if it was pseudo code :
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/flow_view.html">flow_view</a></span>(<span class="no">rle</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"##"</span>, <span class="kw">code</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<div id="htmlwidget-10b47f1d927fa42891e6" style="width:768px;height:768px;" class="nomnoml html-widget"></div>
<script type="application/json" data-for="htmlwidget-10b47f1d927fa42891e6">{"x":{"code":"#.if: visual=rhomb fill=#e2efda align=center\n#.for: visual=rhomb fill=#ddebf7 align=center\n#.repeat: visual=rhomb fill=#fce4d6 align=center\n#.while: visual=rhomb fill=#fff2cc align=center\n#.standard: visual=class fill=#ededed align=left\n#.commented: visual=class fill=#ededed\n#.header: visual=roundrect fill=#d9e1f2 align=left\n#.return: visual=end fill=#70ad47  empty\n#.stop: visual=end fill=#ed7d31  empty\n#.break: visual=receiver fill=#ffc000 empty\n#.next: visual=transceiver fill=#5b9bd5  empty\n#arrowSize: 1\n#bendSize: 0.3\n#direction: down\n#gutter: 5\n#edgeMargin: 0\n#edges: hard\n#fill: #eee8d5\n#fillArrows: false\n#font: Courier\n#fontSize: 12\n#leading: 1.25\n#lineWidth: 3\n#padding: 16\n#spacing: 40\n#stroke: #33322E\n#title: filename\n#zoom: 1\n#acyclicer: greedy\n#ranker: network-simplex\n\n[<header>rle(x)]  -> [<if> 1: is argument of wrong type ?;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 1: is argument of wrong type ?;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 2:]\n[<standard> 2:]  -> [<stop> -2:]\n[<if> 1: is argument of wrong type ?;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -1:]\n[<end> -1:]  -> [<standard> 3:]\n[<standard> 3:]  -> [<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 5: return a rle object with zero length elements]\n[<standard> 5: return a rle object with zero length elements]  -> [<return> -5:]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -4:]\n[<end> -4:]  -> [<standard> 6: compute index of elements that are distinct from the next]\n[<standard> 6: compute index of elements that are distinct from the next]  -> [<standard> 7: compute the final object]\n[<standard> 7: compute the final object]  -> [<return> 8:]","svg":false},"evals":[],"jsHooks":[]}</script><p>An intermediate is to use <code>code = NA</code>, to show only header whenever they are available, note that in that case even the <code>if</code> block’s text was simplified :</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/flow_view.html">flow_view</a></span>(<span class="no">rle</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"##"</span>, <span class="kw">code</span> <span class="kw">=</span> <span class="fl">NA</span>)</pre></body></html></div>
<div id="htmlwidget-ea6ab9c31d1ced8078a3" style="width:768px;height:768px;" class="nomnoml html-widget"></div>
<script type="application/json" data-for="htmlwidget-ea6ab9c31d1ced8078a3">{"x":{"code":"#.if: visual=rhomb fill=#e2efda align=center\n#.for: visual=rhomb fill=#ddebf7 align=center\n#.repeat: visual=rhomb fill=#fce4d6 align=center\n#.while: visual=rhomb fill=#fff2cc align=center\n#.standard: visual=class fill=#ededed align=left\n#.commented: visual=class fill=#ededed\n#.header: visual=roundrect fill=#d9e1f2 align=left\n#.return: visual=end fill=#70ad47  empty\n#.stop: visual=end fill=#ed7d31  empty\n#.break: visual=receiver fill=#ffc000 empty\n#.next: visual=transceiver fill=#5b9bd5  empty\n#arrowSize: 1\n#bendSize: 0.3\n#direction: down\n#gutter: 5\n#edgeMargin: 0\n#edges: hard\n#fill: #eee8d5\n#fillArrows: false\n#font: Courier\n#fontSize: 12\n#leading: 1.25\n#lineWidth: 3\n#padding: 16\n#spacing: 40\n#stroke: #33322E\n#title: filename\n#zoom: 1\n#acyclicer: greedy\n#ranker: network-simplex\n\n[<header>rle(x)]  -> [<if> 1: is argument of wrong type ?]\n[<if> 1: is argument of wrong type ?] y -> [<standard> 2: ;stop(\"'x'⠀must⠀be⠀a⠀vector⠀of⠀an⠀atomic⠀type\")]\n[<standard> 2: ;stop(\"'x'⠀must⠀be⠀a⠀vector⠀of⠀an⠀atomic⠀type\")]  -> [<stop> -2:]\n[<if> 1: is argument of wrong type ?] n -> [<end> -1:]\n[<end> -1:]  -> [<standard> 3: ;n⠀<-⠀length(x)]\n[<standard> 3: ;n⠀<-⠀length(x)]  -> [<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 5: return a rle object with zero length elements]\n[<standard> 5: return a rle object with zero length elements]  -> [<return> -5:]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -4:]\n[<end> -4:]  -> [<standard> 6: compute index of elements that are distinct from the next]\n[<standard> 6: compute index of elements that are distinct from the next]  -> [<standard> 7: compute the final object]\n[<standard> 7: compute the final object]  -> [<return> 8:]","svg":false},"evals":[],"jsHooks":[]}</script>
</div>
<div id="narrow-down-a-wide-diagram" class="section level2">
<h2 class="hasAnchor">
<a href="#narrow-down-a-wide-diagram" class="anchor"></a>Narrow down a wide diagram</h2>
<p>In our simple example you can see that the main branch has shifted from the center after the first <code>if</code> block. This is not a problem here but for bigger diagrams you might have the issue of the diagram shifting right significantly. This can be undesirable for web pages, pdf documents etc where we’d like to have everything fit on the width of the page whenever possible.</p>
<p>The <code>narrow</code> argument makes it possible, at the cost of drawing a longer diagram.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/flow_view.html">flow_view</a></span>(<span class="no">rle</span>, <span class="kw">narrow</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<div id="htmlwidget-043f2354f189661d71fc" style="width:768px;height:768px;" class="nomnoml html-widget"></div>
<script type="application/json" data-for="htmlwidget-043f2354f189661d71fc">{"x":{"code":"#.if: visual=rhomb fill=#e2efda align=center\n#.for: visual=rhomb fill=#ddebf7 align=center\n#.repeat: visual=rhomb fill=#fce4d6 align=center\n#.while: visual=rhomb fill=#fff2cc align=center\n#.standard: visual=class fill=#ededed align=left\n#.commented: visual=class fill=#ededed\n#.header: visual=roundrect fill=#d9e1f2 align=left\n#.return: visual=end fill=#70ad47  empty\n#.stop: visual=end fill=#ed7d31  empty\n#.break: visual=receiver fill=#ffc000 empty\n#.next: visual=transceiver fill=#5b9bd5  empty\n#arrowSize: 1\n#bendSize: 0.3\n#direction: down\n#gutter: 5\n#edgeMargin: 0\n#edges: hard\n#fill: #eee8d5\n#fillArrows: false\n#font: Courier\n#fontSize: 12\n#leading: 1.25\n#lineWidth: 3\n#padding: 16\n#spacing: 40\n#stroke: #33322E\n#title: filename\n#zoom: 1\n#acyclicer: greedy\n#ranker: network-simplex\n\n[<header>rle(x)]  -> [<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 2: ;stop(\"'x'⠀must⠀be⠀a⠀vector⠀of⠀an⠀atomic⠀type\")]\n[<standard> 2: ;stop(\"'x'⠀must⠀be⠀a⠀vector⠀of⠀an⠀atomic⠀type\")]  -> [<stop> -2:]\n[<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -1:]\n[<stop> -2:]  -/- [<end> -1:]\n[<end> -1:]  -> [<standard> 3: ;n⠀<-⠀length(x)]\n[<standard> 3: ;n⠀<-⠀length(x)]  -> [<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 5: ;return(structure(list(\n⠀⠀lengths⠀=⠀integer(),\n⠀⠀values⠀=⠀x\n),⠀class⠀=⠀\"rle\"))]\n[<standard> 5: ;return(structure(list(\n⠀⠀lengths⠀=⠀integer(),\n⠀⠀values⠀=⠀x\n),⠀class⠀=⠀\"rle\"))]  -> [<return> -5:]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -4:]\n[<return> -5:]  -/- [<end> -4:]\n[<end> -4:]  -> [<standard> 6: ;y⠀<-⠀x\\[-1L\\]⠀!=⠀x\\[-n\\]\ni⠀<-⠀c(which(y⠀\\|⠀is.na(y)),⠀n)\nstructure(list(\n⠀⠀lengths⠀=⠀diff(c(0L,⠀i)),\n⠀⠀values⠀=⠀x\\[i\\]\n),⠀class⠀=⠀\"rle\")]\n[<standard> 6: ;y⠀<-⠀x\\[-1L\\]⠀!=⠀x\\[-n\\]\ni⠀<-⠀c(which(y⠀\\|⠀is.na(y)),⠀n)\nstructure(list(\n⠀⠀lengths⠀=⠀diff(c(0L,⠀i)),\n⠀⠀values⠀=⠀x\\[i\\]\n),⠀class⠀=⠀\"rle\")]  -> [<return> 7:]","svg":false},"evals":[],"jsHooks":[]}</script>
</div>
<div id="display-nested-functions-as-diagrams" class="section level2">
<h2 class="hasAnchor">
<a href="#display-nested-functions-as-diagrams" class="anchor"></a>Display nested functions as diagrams</h2>
<p>A function’s body often contains other function definitions, sometimes anonymous, sometimes assigned to a variable.</p>
<p>The <code>nested_fun</code> argument allows you to explore any of those.</p>
<p>A good example is the base function <code><a href="https://rdrr.io/r/base/bquote.html">bquote()</a></code>, it defines a couple functions, and the diagram that <em>{flow}</em> draws is not fully satisfactory.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/flow_view.html">flow_view</a></span>(<span class="no">bquote</span>)
<span class="co">#&gt; We found function definitions in this code, use the argument nested_fun to inspect them</span>
<span class="co">#&gt; $unquote</span>
<span class="co">#&gt; function(e) {</span>
<span class="co">#&gt;     if (is.pairlist(e)) </span>
<span class="co">#&gt;         as.pairlist(lapply(e, unquote))</span>
<span class="co">#&gt;     else if (is.call(e)) {</span>
<span class="co">#&gt;         if (is.name(e[[1L]]) &amp;&amp; as.character(e[[1]]) == ".") </span>
<span class="co">#&gt;             eval(e[[2L]], where)</span>
<span class="co">#&gt;         else if (splice) {</span>
<span class="co">#&gt;             if (is.name(e[[1L]]) &amp;&amp; as.character(e[[1L]]) == </span>
<span class="co">#&gt;                 "..") </span>
<span class="co">#&gt;                 stop("can only splice inside a call", call. = FALSE)</span>
<span class="co">#&gt;             else as.call(unquote.list(e))</span>
<span class="co">#&gt;         }</span>
<span class="co">#&gt;         else as.call(lapply(e, unquote))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else e</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $is.splice.macro</span>
<span class="co">#&gt; function(e) is.call(e) &amp;&amp; is.name(e[[1L]]) &amp;&amp; as.character(e[[1L]]) == </span>
<span class="co">#&gt;     ".."</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $unquote.list</span>
<span class="co">#&gt; function(e) {</span>
<span class="co">#&gt;     p &lt;- Position(is.splice.macro, e, nomatch = NULL)</span>
<span class="co">#&gt;     if (is.null(p)) </span>
<span class="co">#&gt;         lapply(e, unquote)</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         n &lt;- length(e)</span>
<span class="co">#&gt;         head &lt;- if (p == 1) </span>
<span class="co">#&gt;             NULL</span>
<span class="co">#&gt;         else e[1:(p - 1)]</span>
<span class="co">#&gt;         tail &lt;- if (p == n) </span>
<span class="co">#&gt;             NULL</span>
<span class="co">#&gt;         else e[(p + 1):n]</span>
<span class="co">#&gt;         macro &lt;- e[[p]]</span>
<span class="co">#&gt;         mexp &lt;- eval(macro[[2L]], where)</span>
<span class="co">#&gt;         if (!is.vector(mexp)) </span>
<span class="co">#&gt;             stop("can only splice vectors")</span>
<span class="co">#&gt;         c(lapply(head, unquote), mexp, as.list(unquote.list(tail)))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt; }</span></pre></body></html></div>
<div id="htmlwidget-8830d36a325e84f9e9c2" style="width:768px;height:768px;" class="nomnoml html-widget"></div>
<script type="application/json" data-for="htmlwidget-8830d36a325e84f9e9c2">{"x":{"code":"#.if: visual=rhomb fill=#e2efda align=center\n#.for: visual=rhomb fill=#ddebf7 align=center\n#.repeat: visual=rhomb fill=#fce4d6 align=center\n#.while: visual=rhomb fill=#fff2cc align=center\n#.standard: visual=class fill=#ededed align=left\n#.commented: visual=class fill=#ededed\n#.header: visual=roundrect fill=#d9e1f2 align=left\n#.return: visual=end fill=#70ad47  empty\n#.stop: visual=end fill=#ed7d31  empty\n#.break: visual=receiver fill=#ffc000 empty\n#.next: visual=transceiver fill=#5b9bd5  empty\n#arrowSize: 1\n#bendSize: 0.3\n#direction: down\n#gutter: 5\n#edgeMargin: 0\n#edges: hard\n#fill: #eee8d5\n#fillArrows: false\n#font: Courier\n#fontSize: 12\n#leading: 1.25\n#lineWidth: 3\n#padding: 16\n#spacing: 40\n#stroke: #33322E\n#title: filename\n#zoom: 1\n#acyclicer: greedy\n#ranker: network-simplex\n\n[<header>bquote(expr,⠀where⠀=⠀parent.frame(),⠀splice⠀=⠀FALSE)]  -> [<if> 1: ;⠀⠀if⠀(!is.environment(where))⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 1: ;⠀⠀if⠀(!is.environment(where))⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 2: ;where⠀<-⠀as.environment(where)]\n[<standard> 2: ;where⠀<-⠀as.environment(where)]  -> [<end> -1:]\n[<if> 1: ;⠀⠀if⠀(!is.environment(where))⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -1:]\n[<end> -1:]  -> [<standard> 3: ;unquote⠀<-⠀function(e)⠀{\n⠀⠀if⠀(is.pairlist(e))⠀{\n⠀⠀⠀⠀as.pairlist(lapply(e,⠀unquote))\n⠀⠀}⠀else⠀if⠀(is.call(e))⠀{\n⠀⠀⠀⠀if⠀(is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1\\]\\])⠀==\n⠀⠀⠀⠀⠀⠀\".\")⠀{\n⠀⠀⠀⠀⠀⠀eval(e\\[\\[2L\\]\\],⠀where)\n⠀⠀⠀⠀}⠀else⠀if⠀(splice)⠀{\n⠀⠀⠀⠀⠀⠀if⠀(is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1L\\]\\])⠀==\n⠀⠀⠀⠀⠀⠀⠀⠀\"..\")⠀{\n⠀⠀⠀⠀⠀⠀⠀⠀stop(\"can⠀only⠀splice⠀inside⠀a⠀call\",\n⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀call.⠀=⠀FALSE\n⠀⠀⠀⠀⠀⠀⠀⠀)\n⠀⠀⠀⠀⠀⠀}⠀else⠀{\n⠀⠀⠀⠀⠀⠀⠀⠀as.call(unquote.list(e))\n⠀⠀⠀⠀⠀⠀}\n⠀⠀⠀⠀}\n⠀⠀⠀⠀else⠀{\n⠀⠀⠀⠀⠀⠀as.call(lapply(e,⠀unquote))\n⠀⠀⠀⠀}\n⠀⠀}\n⠀⠀else⠀{\n⠀⠀⠀⠀e\n⠀⠀}\n}\nis.splice.macro⠀<-⠀function(e)⠀{\n⠀⠀is.call(e)⠀&&\n⠀⠀⠀⠀is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1L\\]\\])⠀==\n⠀⠀⠀⠀\"..\"\n}\nunquote.list⠀<-⠀function(e)⠀{\n⠀⠀p⠀<-⠀Position(is.splice.macro,⠀e,⠀nomatch⠀=⠀NULL)\n⠀⠀if⠀(is.null(p))⠀{\n⠀⠀⠀⠀lapply(e,⠀unquote)\n⠀⠀}⠀else⠀{\n⠀⠀⠀⠀n⠀<-⠀length(e)\n⠀⠀⠀⠀if⠀(p⠀==⠀1)⠀{\n⠀⠀⠀⠀⠀⠀head⠀<-⠀NULL\n⠀⠀⠀⠀}⠀else⠀{\n⠀⠀⠀⠀⠀⠀head⠀<-⠀e\\[1:(p⠀-⠀1)\\]\n⠀⠀⠀⠀}\n⠀⠀⠀⠀if⠀(p⠀==⠀n)⠀{\n⠀⠀⠀⠀⠀⠀tail⠀<-⠀NULL\n⠀⠀⠀⠀}⠀else⠀{\n⠀⠀⠀⠀⠀⠀tail⠀<-⠀e\\[(p⠀+⠀1):n\\]\n⠀⠀⠀⠀}\n⠀⠀⠀⠀macro⠀<-⠀e\\[\\[p\\]\\]\n⠀⠀⠀⠀mexp⠀<-⠀eval(macro\\[\\[2L\\]\\],⠀where)\n⠀⠀⠀⠀if⠀(!is.vector(mexp))⠀{\n⠀⠀⠀⠀⠀⠀stop(\"can⠀only⠀splice⠀vectors\")\n⠀⠀⠀⠀}\n⠀⠀⠀⠀c(lapply(head,⠀unquote),⠀mexp,⠀as.list(unquote.list(tail)))\n⠀⠀}\n}\nunquote(substitute(expr))]\n[<standard> 3: ;unquote⠀<-⠀function(e)⠀{\n⠀⠀if⠀(is.pairlist(e))⠀{\n⠀⠀⠀⠀as.pairlist(lapply(e,⠀unquote))\n⠀⠀}⠀else⠀if⠀(is.call(e))⠀{\n⠀⠀⠀⠀if⠀(is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1\\]\\])⠀==\n⠀⠀⠀⠀⠀⠀\".\")⠀{\n⠀⠀⠀⠀⠀⠀eval(e\\[\\[2L\\]\\],⠀where)\n⠀⠀⠀⠀}⠀else⠀if⠀(splice)⠀{\n⠀⠀⠀⠀⠀⠀if⠀(is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1L\\]\\])⠀==\n⠀⠀⠀⠀⠀⠀⠀⠀\"..\")⠀{\n⠀⠀⠀⠀⠀⠀⠀⠀stop(\"can⠀only⠀splice⠀inside⠀a⠀call\",\n⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀call.⠀=⠀FALSE\n⠀⠀⠀⠀⠀⠀⠀⠀)\n⠀⠀⠀⠀⠀⠀}⠀else⠀{\n⠀⠀⠀⠀⠀⠀⠀⠀as.call(unquote.list(e))\n⠀⠀⠀⠀⠀⠀}\n⠀⠀⠀⠀}\n⠀⠀⠀⠀else⠀{\n⠀⠀⠀⠀⠀⠀as.call(lapply(e,⠀unquote))\n⠀⠀⠀⠀}\n⠀⠀}\n⠀⠀else⠀{\n⠀⠀⠀⠀e\n⠀⠀}\n}\nis.splice.macro⠀<-⠀function(e)⠀{\n⠀⠀is.call(e)⠀&&\n⠀⠀⠀⠀is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1L\\]\\])⠀==\n⠀⠀⠀⠀\"..\"\n}\nunquote.list⠀<-⠀function(e)⠀{\n⠀⠀p⠀<-⠀Position(is.splice.macro,⠀e,⠀nomatch⠀=⠀NULL)\n⠀⠀if⠀(is.null(p))⠀{\n⠀⠀⠀⠀lapply(e,⠀unquote)\n⠀⠀}⠀else⠀{\n⠀⠀⠀⠀n⠀<-⠀length(e)\n⠀⠀⠀⠀if⠀(p⠀==⠀1)⠀{\n⠀⠀⠀⠀⠀⠀head⠀<-⠀NULL\n⠀⠀⠀⠀}⠀else⠀{\n⠀⠀⠀⠀⠀⠀head⠀<-⠀e\\[1:(p⠀-⠀1)\\]\n⠀⠀⠀⠀}\n⠀⠀⠀⠀if⠀(p⠀==⠀n)⠀{\n⠀⠀⠀⠀⠀⠀tail⠀<-⠀NULL\n⠀⠀⠀⠀}⠀else⠀{\n⠀⠀⠀⠀⠀⠀tail⠀<-⠀e\\[(p⠀+⠀1):n\\]\n⠀⠀⠀⠀}\n⠀⠀⠀⠀macro⠀<-⠀e\\[\\[p\\]\\]\n⠀⠀⠀⠀mexp⠀<-⠀eval(macro\\[\\[2L\\]\\],⠀where)\n⠀⠀⠀⠀if⠀(!is.vector(mexp))⠀{\n⠀⠀⠀⠀⠀⠀stop(\"can⠀only⠀splice⠀vectors\")\n⠀⠀⠀⠀}\n⠀⠀⠀⠀c(lapply(head,⠀unquote),⠀mexp,⠀as.list(unquote.list(tail)))\n⠀⠀}\n}\nunquote(substitute(expr))]  -> [<return> 4:]","svg":false},"evals":[],"jsHooks":[]}</script><p><em>{flow}</em> detects the function definitions and proposes you to investigate them. Let’s see what <code>unquote()</code> is about.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/flow_view.html">flow_view</a></span>(<span class="no">bquote</span>, <span class="kw">nested_fun</span> <span class="kw">=</span> <span class="st">"unquote"</span>)</pre></body></html></div>
<div id="htmlwidget-d81deefa338c344558fa" style="width:768px;height:768px;" class="nomnoml html-widget"></div>
<script type="application/json" data-for="htmlwidget-d81deefa338c344558fa">{"x":{"code":"#.if: visual=rhomb fill=#e2efda align=center\n#.for: visual=rhomb fill=#ddebf7 align=center\n#.repeat: visual=rhomb fill=#fce4d6 align=center\n#.while: visual=rhomb fill=#fff2cc align=center\n#.standard: visual=class fill=#ededed align=left\n#.commented: visual=class fill=#ededed\n#.header: visual=roundrect fill=#d9e1f2 align=left\n#.return: visual=end fill=#70ad47  empty\n#.stop: visual=end fill=#ed7d31  empty\n#.break: visual=receiver fill=#ffc000 empty\n#.next: visual=transceiver fill=#5b9bd5  empty\n#arrowSize: 1\n#bendSize: 0.3\n#direction: down\n#gutter: 5\n#edgeMargin: 0\n#edges: hard\n#fill: #eee8d5\n#fillArrows: false\n#font: Courier\n#fontSize: 12\n#leading: 1.25\n#lineWidth: 3\n#padding: 16\n#spacing: 40\n#stroke: #33322E\n#title: filename\n#zoom: 1\n#acyclicer: greedy\n#ranker: network-simplex\n\n[<header>fun(e)]  -> [<if> 1: ;⠀⠀if⠀(is.pairlist(e))⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 1: ;⠀⠀if⠀(is.pairlist(e))⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 2: ;as.pairlist(lapply(e,⠀unquote))]\n[<standard> 2: ;as.pairlist(lapply(e,⠀unquote))]  -> [<end> -1:]\n[<if> 1: ;⠀⠀if⠀(is.pairlist(e))⠀⠀\n⠀⠀⠀⠀⠀] n -> [<if> 3: ;⠀⠀if⠀(is.call(e))⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 3: ;⠀⠀if⠀(is.call(e))⠀⠀\n⠀⠀⠀⠀⠀] y -> [<if> 4: ;⠀⠀if⠀(is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1\\]\\])⠀==⠀⠀\n⠀⠀⠀⠀\".\")]\n[<if> 4: ;⠀⠀if⠀(is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1\\]\\])⠀==⠀⠀\n⠀⠀⠀⠀\".\")] y -> [<standard> 5: ;eval(e\\[\\[2L\\]\\],⠀where)]\n[<standard> 5: ;eval(e\\[\\[2L\\]\\],⠀where)]  -> [<end> -4:]\n[<if> 4: ;⠀⠀if⠀(is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1\\]\\])⠀==⠀⠀\n⠀⠀⠀⠀\".\")] n -> [<if> 6: ;⠀⠀if⠀(splice)⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 6: ;⠀⠀if⠀(splice)⠀⠀\n⠀⠀⠀⠀⠀] y -> [<if> 7: ;⠀⠀if⠀(is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1L\\]\\])⠀==⠀⠀\n⠀⠀⠀⠀\"..\")]\n[<if> 7: ;⠀⠀if⠀(is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1L\\]\\])⠀==⠀⠀\n⠀⠀⠀⠀\"..\")] y -> [<standard> 8: ;stop(\"can⠀only⠀splice⠀inside⠀a⠀call\",⠀call.⠀=⠀FALSE)]\n[<standard> 8: ;stop(\"can⠀only⠀splice⠀inside⠀a⠀call\",⠀call.⠀=⠀FALSE)]  -> [<stop> -8:]\n[<if> 7: ;⠀⠀if⠀(is.name(e\\[\\[1L\\]\\])⠀&&⠀as.character(e\\[\\[1L\\]\\])⠀==⠀⠀\n⠀⠀⠀⠀\"..\")] n -> [<standard> 9: ;as.call(unquote.list(e))]\n[<standard> 9: ;as.call(unquote.list(e))]  -> [<end> -7:]\n[<end> -7:]  -> [<end> -6:]\n[<if> 6: ;⠀⠀if⠀(splice)⠀⠀\n⠀⠀⠀⠀⠀] n -> [<standard> 10: ;as.call(lapply(e,⠀unquote))]\n[<standard> 10: ;as.call(lapply(e,⠀unquote))]  -> [<end> -6:]\n[<end> -6:]  -> [<end> -4:]\n[<end> -4:]  -> [<end> -3:]\n[<if> 3: ;⠀⠀if⠀(is.call(e))⠀⠀\n⠀⠀⠀⠀⠀] n -> [<standard> 11: ;e]\n[<standard> 11: ;e]  -> [<end> -3:]\n[<end> -3:]  -> [<end> -1:]\n[<end> -1:]  -> [<return> 12:]","svg":false},"evals":[],"jsHooks":[]}</script>
</div>
<div id="other-arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#other-arguments" class="anchor"></a>Other arguments</h2>
<p><code>swap</code>, <code>TRUE</code> by default, edits the statements like :</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">x</span> <span class="kw">&lt;-</span> <span class="kw">if</span>(<span class="no">cond</span>) <span class="no">this</span> <span class="kw">else</span> <span class="no">that</span></pre></body></html></div>
<p>into</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="kw">if</span>(<span class="no">cond</span>) <span class="no">x</span> <span class="kw">&lt;-</span> <span class="no">this</span> <span class="kw">else</span> <span class="no">x</span> <span class="kw">&lt;-</span> <span class="no">that</span></pre></body></html></div>
<p>The reason is that the latter version can be represented by a diagram while the first can’t. The logic stays the same however. If you want to make sure you see the original code, use <code>swap = FALSE</code>.</p>
<p><code>engine_opts</code> is used to pass arguments to engine specific functions.</p>
<p>In the most general case <code>engine_opts</code> is a list containing optional sub-lists named <code>"nomnoml"</code>, <code>"plantuml"</code>, and <code>"htmlwidgets"</code>.</p>
<ul>
<li>The items of the <code>nomnoml</code> sub-list will be forwarded to <code>nomnoml:::build_nomnoml_code()</code>, unexported but documented in <code><a href="../reference/build_nomnoml_code.html">?build_nomnoml_code</a></code>, in order to alter <em>nomnoml</em> diagrams. For instance <code>fontSize</code>, <code>direction = "right"</code> to have a left to right diagram, <code>ranker = "longest-path"</code> to see have exit points at the bottom…</li>
<li>The items of the <code>plantuml</code> sub-list will be forwarded to <code>plantuml:::plot.plantuml()</code>, , in order to alter <em>plantuml</em> diagrams. see <code>?plantuml:::plot.plantuml</code> and <code><a href="https://rdrr.io/pkg/plantuml/man/plantuml_run.html">?plantuml::plantuml_run</a></code>
</li>
<li>The items of the <code>htmlwidgets</code> sub-list will be forwarded to <code><a href="https://rdrr.io/pkg/htmlwidgets/man/createWidget.html">htmlwidgets::createWidget()</a></code> or <code><a href="https://rdrr.io/pkg/htmlwidgets/man/saveWidget.html">htmlwidgets::saveWidget()</a></code>, which are used by the <em>nomnoml</em> engine.</li>
</ul>
<p>If this structure is not found, the items of <code>engine_opts</code> will be forwarded to <code>nomnoml:::build_nomnoml_code()</code> if the engine is <code>"nomnoml"</code>, and <code>plantuml:::plot.plantuml</code> if the engine is <code>"plantuml"</code></p>
<p>For instance here’s a custom representation of <code>rle</code></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="../reference/flow_view.html">flow_view</a></span>(<span class="no">rle</span>, <span class="kw">engine_opts</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">ranker</span> <span class="kw">=</span> <span class="st">"longest-path"</span>, <span class="kw">direction</span> <span class="kw">=</span> <span class="st">"right"</span>))</pre></body></html></div>
<div id="htmlwidget-c1c6a441a2abc6336c66" style="width:768px;height:768px;" class="nomnoml html-widget"></div>
<script type="application/json" data-for="htmlwidget-c1c6a441a2abc6336c66">{"x":{"code":"#.if: visual=rhomb fill=#e2efda align=center\n#.for: visual=rhomb fill=#ddebf7 align=center\n#.repeat: visual=rhomb fill=#fce4d6 align=center\n#.while: visual=rhomb fill=#fff2cc align=center\n#.standard: visual=class fill=#ededed align=left\n#.commented: visual=class fill=#ededed\n#.header: visual=roundrect fill=#d9e1f2 align=left\n#.return: visual=end fill=#70ad47  empty\n#.stop: visual=end fill=#ed7d31  empty\n#.break: visual=receiver fill=#ffc000 empty\n#.next: visual=transceiver fill=#5b9bd5  empty\n#arrowSize: 1\n#bendSize: 0.3\n#direction: right\n#gutter: 5\n#edgeMargin: 0\n#edges: hard\n#fill: #eee8d5\n#fillArrows: false\n#font: Courier\n#fontSize: 12\n#leading: 1.25\n#lineWidth: 3\n#padding: 16\n#spacing: 40\n#stroke: #33322E\n#title: filename\n#zoom: 1\n#acyclicer: greedy\n#ranker: longest-path\n\n[<header>rle(x)]  -> [<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 2: ;stop(\"'x'⠀must⠀be⠀a⠀vector⠀of⠀an⠀atomic⠀type\")]\n[<standard> 2: ;stop(\"'x'⠀must⠀be⠀a⠀vector⠀of⠀an⠀atomic⠀type\")]  -> [<stop> -2:]\n[<if> 1: ;⠀⠀if⠀(!is.vector(x)⠀&&⠀!is.list(x))⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -1:]\n[<end> -1:]  -> [<standard> 3: ;n⠀<-⠀length(x)]\n[<standard> 3: ;n⠀<-⠀length(x)]  -> [<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] y -> [<standard> 5: ;return(structure(list(\n⠀⠀lengths⠀=⠀integer(),\n⠀⠀values⠀=⠀x\n),⠀class⠀=⠀\"rle\"))]\n[<standard> 5: ;return(structure(list(\n⠀⠀lengths⠀=⠀integer(),\n⠀⠀values⠀=⠀x\n),⠀class⠀=⠀\"rle\"))]  -> [<return> -5:]\n[<if> 4: ;⠀⠀if⠀(n⠀==⠀0L)⠀⠀\n⠀⠀⠀⠀⠀] n -> [<end> -4:]\n[<end> -4:]  -> [<standard> 6: ;y⠀<-⠀x\\[-1L\\]⠀!=⠀x\\[-n\\]\ni⠀<-⠀c(which(y⠀\\|⠀is.na(y)),⠀n)\nstructure(list(\n⠀⠀lengths⠀=⠀diff(c(0L,⠀i)),\n⠀⠀values⠀=⠀x\\[i\\]\n),⠀class⠀=⠀\"rle\")]\n[<standard> 6: ;y⠀<-⠀x\\[-1L\\]⠀!=⠀x\\[-n\\]\ni⠀<-⠀c(which(y⠀\\|⠀is.na(y)),⠀n)\nstructure(list(\n⠀⠀lengths⠀=⠀diff(c(0L,⠀i)),\n⠀⠀values⠀=⠀x\\[i\\]\n),⠀class⠀=⠀\"rle\")]  -> [<return> 7:]","svg":false},"evals":[],"jsHooks":[]}</script>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Antoine Fabri.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
